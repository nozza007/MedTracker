<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Daily Medication Tracker</title>
  <style>
    :root {
      --bg: #fdfdfd;
      --text: #222;
      --card: #ffffff;
      --border: #ddd;
      --accent-morning: #fef7e0;
      --accent-evening: #e3f2fd;
    }
    
    input.invalid {
      border: 2px solid #d9534f;
      background-color: #fff0f0;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 1em;
      background-color: var(--bg);
      color: var(--text);
    }

    h1 {
      text-align: center;
      font-size: 1.8em;
    }

    .note {
      text-align: center;
      font-size: 0.95em;
      margin-bottom: 1em;
    }

    .table-wrapper {
      overflow-x: auto;
      max-width: 100%;
      margin-bottom: 1.5em;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--card);
      border: 1px solid var(--border);
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    th, td {
      padding: 1em;
      border: 1px solid var(--border);
      text-align: center;
      font-size: 1em;
    }

    th {
      background-color: var(--border);
    }

    .morning {
      background-color: var(--accent-morning);
    }

    .evening {
      background-color: var(--accent-evening);
    }

    .commit-button {
      display: block;
      margin: 1.5em auto;
      padding: 0.7em 2em;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 1em;
      cursor: pointer;
    }

    .commit-button:hover {
      background-color: #0056b3;
    }

    input[type="number"] {
      width: 4em;
      padding: 0.3em;
      font-size: 1em;
    }
    .prog-controls label {
    display: inline-block;
    margin-bottom: 0.3em;
    }
      td > div {
    text-align: left; /* override the default 'center' for nested content */
    }
  
    @media (max-width: 600px) {
      h1 {
        font-size: 1.4em;
      }
      th, td {
        padding: 0.7em;
        font-size: 0.95em;
      }
    }
  </style>
</head>

  
<body>
  <h1>Daily Medication Tracker</h1>
  <div class="note" id="dateDisplay"></div>

  <div class="table-wrapper">
    <table id="medTable">
      <thead>
        <tr>
          <th>Medication</th>
          <th class="morning">Morning Dose</th>
          <th class="evening">Evening Dose</th>
          <th>Amend Dosage</th>
        </tr>
      </thead>
      <tbody>
        <tr data-med="Estilsona">
          <td>Estilsona</td>
          <td class="morning">4 ml</td>
          <td class="evening">—</td>
          <td><input type="number" step="0.1" min="0" max="10" /></td>
        </tr>
        <tr data-med="Depakine">
          <td>Depakine</td>
          <td class="morning">1.7 ml</td>
          <td class="evening">1.7 ml</td>
          <td><input type="number" step="0.1" min="0" max="10" /></td>
        </tr>
        <tr data-med="Omeprazole">
          <td>Omeprazole</td>
          <td class="morning">4 ml</td>
          <td class="evening">—</td>
          <td><input type="number" step="0.1" min="0" max="10" /></td>
        </tr>
        <tr data-med="Vitamin D">
          <td>Vitamin D</td>
          <td class="morning">0.2 ml</td>
          <td class="evening">—</td>
          <td><input type="number" step="0.1" min="0" max="10" /></td>
        </tr>
        <tr data-med="CBD">
          <td>CBD (progressive)</td>
          <td class="morning" id="progDoseMorning">Calculating...</td>
          <td class="evening" id="progDoseEvening">Calculating...</td>
          <td><input type="number" step="0.1" min="0" max="10" />
              <div style="margin-top: 0.5em; text-align: left; font-size: 0.85em;">
              <label>
              <input type="checkbox" class="prog-toggle" />
              Progressive
              </label>
              <div class="prog-controls" style="display: none; margin-top: 0.3em;">
        <label>
              Increment:
              <input type="number" class="prog-increment" step="0.1" min="0.1" max="10" style="width: 4em;" />
              </label>
              <br />
              <label>
              <input type="radio" name="interval-type-CBD" value="days" checked class="prog-interval-type" />
              Days
              </label>
              <label>
                <input type="radio" name="interval-type-CBD" value="hours" class="prog-interval-type" />
              Hours
              </label>
              <br />
              <label>
              Interval:
                <input type="number" class="prog-interval" min="1" max="30" style="width: 4em;" />
              </label>
              </div>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <button class="commit-button" onclick="commitAmendments()">Commit</button>

  <script>
    let cbdProgressiveConfig = null;
    const today = new Date();
    document.getElementById("dateDisplay").innerText = "Today is: " + today.toDateString();

    // Initial CBD progressive dosage calculation
    let cbdBaseDose = 0.1;
    const cbdStartDate = new Date("2025-03-27");
    const doseStep = 0.1;
    const intervalDays = 4;

    function calculateCBDDose() {
  if (!cbdProgressiveConfig) {
    // fallback to default logic
    const startDate = new Date("2025-03-27");
    const base = 0.1;
    const interval = 4;
    const daysElapsed = Math.floor((today - startDate) / (1000 * 3600 * 24));
    const steps = Math.floor(daysElapsed / interval);
    const currentDose = base + steps * 0.1;
    const text = currentDose.toFixed(1) + " ml";
    document.getElementById("progDoseMorning").innerText = text;
    document.getElementById("progDoseEvening").innerText = text;
    return;
  }

  const { baseDose, increment, intervalValue, intervalUnit, startDate } = cbdProgressiveConfig;

  let elapsedUnits;
  if (intervalUnit === "days") {
    elapsedUnits = Math.floor((today - startDate) / (1000 * 3600 * 24));
  } else {
    elapsedUnits = Math.floor((today - startDate) / (1000 * 3600 * intervalValue));
  }

  const steps = Math.floor(elapsedUnits / intervalValue);
  const currentDose = baseDose + (steps * increment);
  const text = currentDose.toFixed(1) + " ml";

  document.getElementById("progDoseMorning").innerText = text;
  document.getElementById("progDoseEvening").innerText = text;
}


    calculateCBDDose();

function commitAmendments() {
  const rows = document.querySelectorAll("#medTable tbody tr");

  rows.forEach(row => {
    const input = row.querySelector("input[type='number']");
    const newValue = parseFloat(input.value);
    const isCBD = row.dataset.med === "CBD";

    // Remove previous error styling
    input.classList.remove("invalid");

    // Validate input
    const isValid = !isNaN(newValue) && newValue >= 0 && newValue <= 10 && (Math.round(newValue * 10) % 1 === 0);

    if (!isValid && input.value !== "") {
      input.classList.add("invalid");
      return;
    }

    if (isValid) {
      const formatted = newValue.toFixed(1) + " ml";
      const morningCell = row.querySelector(".morning");
      const eveningCell = row.querySelector(".evening");
      
      // Automatic Checker Logic:
      // If the evening cell currently has "—" or is empty, update only the morning cell.
      if (eveningCell.innerText.trim() === "—" || eveningCell.innerText.trim() === "") {
        morningCell.innerText = formatted;
      } else {
        // If both cells already have a value, update both.
        morningCell.innerText = formatted;
        eveningCell.innerText = formatted;
      }

      if (isCBD) {
  // Save baseline dose
  cbdBaseDose = newValue;

  // Check if progressive is enabled
  const progToggle = row.querySelector(".prog-toggle");
  if (progToggle && progToggle.checked) {
    const incrementInput = row.querySelector(".prog-increment");
    const intervalInput = row.querySelector(".prog-interval");
    const intervalTypeInput = row.querySelector('input[name="interval-type-CBD"]:checked');

    const increment = parseFloat(incrementInput.value);
    const intervalValue = parseInt(intervalInput.value);
    const intervalUnit = intervalTypeInput.value;

    // Basic validation for progressive fields
    if (!isNaN(increment) && !isNaN(intervalValue)) {
      cbdProgressiveConfig = {
        baseDose: newValue,
        increment,
        intervalValue,
        intervalUnit,
        startDate: new Date()
      };
    }
  } else {
    cbdProgressiveConfig = null; // reset if not progressive
  }

  calculateCBDDose(); // Recalculate CBD dose with latest values
}


      input.value = "";
    }
  });
}    
   document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".prog-toggle").forEach(toggle => {
    toggle.addEventListener("change", () => {
      const controls = toggle.closest("td").querySelector(".prog-controls");
      controls.style.display = toggle.checked ? "block" : "none";
    });
  });
});


  </script>
</body>
</html>
